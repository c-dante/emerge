(this.webpackJsonpemerge=this.webpackJsonpemerge||[]).push([[0],{46:function(e,t,n){},47:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var r,i,a=n(1),c=n.n(a),o=n(33),s=n.n(o),u=(n(46),n(47),n(8)),l=n(10),v=n(18),d=n(22),f=n(27),b=n(0),j=n(4),h=n(5),O=n(7),g=n(34),p=n.n(g),m=n(66),C=n(6),R=n(12),y=n.n(R),S=n(11),k=n(65),x=function(e,t){var n;return null!==(n=e.resources[t])&&void 0!==n?n:0},W=function(e,t,n){var r=x(e,t)+n;return e.resources[t]=r,r};!function(e){e.Water="Water",e.Seed="Seed",e.Root="Root",e.Cloud="Cloud",e.RainCloud="RainCloud"}(i||(i={}));var w,E=function(e,t){var n=t.get(e.pos);return void 0!==n?n.push(e):t.set(e.pos,[e]),t},I=function(e,t){var n=t.things.queryValues(e.pos,2,9).flat().find((function(e){return e.type===i.Water}));n&&(!function(e,t){var n,r=(null!==(n=t.get(e.pos))&&void 0!==n?n:[]).filter((function(t){return t!==e}));r.length?t.set(e.pos,r):t.remove(e.pos)}(n,t.things),W(e,i.Water,1))},N=(r={},Object(C.a)(r,i.Seed,[I,function(e,t){if(x(e,i.Water)>2){var n=F();n.pos[0]=e.pos[0],n.pos[1]=e.pos[1]+1,E(n,t.things),W(e,i.Water,-2)}}]),Object(C.a)(r,i.Root,[I]),Object(C.a)(r,i.Cloud,[function(e,t){t.tick%3===0&&W(e,i.Water,5),x(e,i.Water)>10&&(e.type=i.RainCloud)}]),Object(C.a)(r,i.RainCloud,[function(e,t){for(var n=4;n>0&&x(e,i.Water)>0;){var r=D();r.pos[0]=e.pos[0],r.pos[1]=e.pos[1],E(r,t.things),W(e,i.Water,-1),n--}0===e.resources[i.Water]&&(e.type=i.Cloud)}]),r),z=function(e){return{resources:{},pos:e}},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return Object(O.a)(Object(O.a)({},z(e)),{},{type:i.Water})},J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return Object(O.a)(Object(O.a)({},z(e)),{},{type:i.Seed,resources:Object(C.a)({},i.Water,0)})},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return Object(O.a)(Object(O.a)({},z(e)),{},{type:i.Root})},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return Object(O.a)(Object(O.a)({},z(e)),{},{type:i.Cloud,resource:Object(C.a)({},i.Water,0)})},B=n(2),L=10,M=function(e){var t=e.onResize,n=void 0===t?y.a.noop:t,r=e.children,i=e.containerProps,c=void 0===i?{style:{height:"100%"}}:i,o=Object(a.useRef)(null),s=Object(a.useRef)(n);Object(a.useEffect)((function(){s.current=n}),[n]);var u=Object(a.useRef)(new ResizeObserver((function(e){if(e.length>0){var t=e[0].contentRect;s.current(t)}})));return Object(a.useEffect)((function(){var e;if(null===(e=o.current)||void 0===e?void 0:e.parentElement){var t=u.current;return t.observe(o.current.parentElement),function(){return t.disconnect()}}}),[o,u]),Object(B.jsx)("div",Object(O.a)(Object(O.a)({},c),{},{ref:o,children:r}))},P="RENDER_SAVE",T=y.a.debounce((function(e){sessionStorage.setItem(P,JSON.stringify(e))}),250),V=function(){var e=sessionStorage.getItem(P);if(!e)return S.b;try{var t=JSON.parse(e);return S.b.translate(t.x,t.y).scale(t.k)}catch(n){return S.b}},_=function(e){var t=e.state,n=e.onResize,r=void 0===n?y.a.noop:n,i=Object(a.useRef)(null),c=Object(a.useState)({width:100,height:100}),o=Object(b.a)(c,2),s=o[0],u=o[1],l=Object(a.useState)(V()),v=Object(b.a)(l,2),d=v[0],f=v[1],h=Object(a.useRef)(Object(S.a)().scaleExtent([1,100]).on("zoom",(function(e){f(e.transform),T(e.transform)}))),O=Object(a.useCallback)((function(e){r(e),u({width:e.width,height:e.height})}),[u,r]);return Object(a.useEffect)((function(){if(i.current&&t){var e=i.current.getContext("2d");if(e){var n=null!==d&&void 0!==d?d:S.b,r=i.current.getBoundingClientRect();null===e||void 0===e||e.clearRect(0,0,r.width,r.height),null===e||void 0===e||e.save(),null===e||void 0===e||e.translate(n.x,n.y),null===e||void 0===e||e.scale(n.k,n.k);var a,c=Object(j.a)(t.things);try{for(c.s();!(a=c.n()).done;){var o,s=Object(b.a)(a.value,2),u=Object(b.a)(s[0],2),l=u[0],v=u[1],f=s[1],h=Object(j.a)(f);try{for(h.s();!(o=h.n()).done;){var O=o.value;e.fillStyle=q[O.type],e.fillRect(11*l-5,11*v-5,L,L)}}catch(g){h.e(g)}finally{h.f()}}}catch(g){c.e(g)}finally{c.f()}e.restore()}}}),[t,d]),Object(a.useEffect)((function(){i.current&&h.current&&Object(k.a)(i.current).call(h.current).call(h.current.transform,V())}),[i,h]),Object(B.jsx)(M,{onResize:O,children:Object(B.jsx)("canvas",{ref:i,width:s.width,height:s.height})})},q=(w={},Object(C.a)(w,i.Cloud,"lightblue"),Object(C.a)(w,i.RainCloud,"slategrey"),Object(C.a)(w,i.Root,"brown"),Object(C.a)(w,i.Seed,"orange"),Object(C.a)(w,i.Water,"blue"),w),G=function(){return{things:[D(),D(),D(),D(),D(),J(),A([0,-1])].reduce((function(e,t){return E(t,e)}),new m.a(2)),tick:0}},U="SIM_STORAGE",H=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(u.a)(this,n),(r=t.call(this,e)).interval=void 0,r.setCanvasDimsCb=r.setCanvasDims.bind(Object(v.a)(r)),r.renderCtrlCb=r.setRenderCtrl.bind(Object(v.a)(r));var i={sim:G(),intervalRate:1e3},a=sessionStorage.getItem(U);if(a)try{i.sim=function(e){var t=JSON.parse(e),n=t.things,r=new m.a(2,n);return{tick:t.tick,things:r}}(a)}catch(c){console.debug(a),console.warn("Failed to load json",c)}return r.state=i,r}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval((function(){var t,n=function(e,t){e.tick+=t;var n,r=Object(j.a)(e.things);try{for(r.s();!(n=r.n()).done;){var i=Object(b.a)(n.value,2)[1];p.a.shuffle(i).forEach((function(n){var r;(null!==(r=N[n.type])&&void 0!==r?r:[]).forEach((function(r){return r(n,e,t)}))}))}}catch(a){r.e(a)}finally{r.f()}return e}(e.state.sim,1);e.state.sim.tick%10===0&&sessionStorage.setItem(U,(t=n,JSON.stringify(Object(O.a)(Object(O.a)({},t),{},{things:Object(h.a)(t.things)})))),e.setState({sim:Object(O.a)({},n)})}),this.state.intervalRate)}},{key:"componentWillUnmount",value:function(){void 0!==this.interval&&(clearInterval(this.interval),this.interval=void 0)}},{key:"setCanvasDims",value:function(e){this.setState({canvasRect:e})}},{key:"setRenderCtrl",value:function(e){this.setState({renderController:e})}},{key:"render",value:function(){var e,t,n,r,i,a,c=this;return Object(B.jsxs)("div",{className:"sim-container",children:[Object(B.jsx)("div",{className:"sim-render-area",children:Object(B.jsx)(_,{state:this.state.sim,onResize:this.setCanvasDimsCb,onCtrl:this.renderCtrlCb})}),Object(B.jsxs)("div",{className:"sim-stats-footer",children:[Object(B.jsx)("p",{children:null===(e=this.state)||void 0===e||null===(t=e.sim)||void 0===t?void 0:t.tick}),Object(B.jsx)("button",{onClick:function(){return c.setState({sim:G()})},children:"Reset"}),Object(B.jsxs)("p",{children:["Size: ",null===(n=this.state)||void 0===n||null===(r=n.canvasRect)||void 0===r?void 0:r.width," x ",null===(i=this.state)||void 0===i||null===(a=i.canvasRect)||void 0===a?void 0:a.height]}),Object(B.jsx)("button",{onClick:function(){var e,t;return null===(e=c.state)||void 0===e||null===(t=e.renderController)||void 0===t?void 0:t.center()},children:"Center"}),Object(B.jsx)("button",{onClick:function(){return console.log(c.state)},children:"Log"})]})]})}}]),n}(c.a.Component);var K=function(){return Object(B.jsx)("div",{className:"App",children:Object(B.jsx)(H,{})})},Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,67)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),r(e),i(e),a(e),c(e)}))};s.a.render(Object(B.jsx)(c.a.StrictMode,{children:Object(B.jsx)(K,{})}),document.getElementById("root")),Q()}},[[54,1,2]]]);
//# sourceMappingURL=main.c16e6fdf.chunk.js.map